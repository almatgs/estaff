<?xml version="1.0" encoding="windows-1251"?>
<agents SPXML-FORM="x-app://base1/base1_agents.xmd"><agent><id>end_date_checker</id><name>Проверка даты окончания событий</name><is_active>1</is_active><code>lib_event.end_date_checker_task()</code><schedule><term><unit_id>d</unit_id></term><time_entries><time_entry><hour>1</hour><minute>0</minute></time_entry></time_entries></schedule><is_std>1</is_std><order_index>0</order_index></agent><agent><id>event_auto_creator</id><name>Автоматическое создание событий</name><is_active>1</is_active><code>lib_event.RunAgentEventAutoCreator()</code><schedule><term><unit_id>d</unit_id></term><time_entries><time_entry><hour>2</hour><minute>0</minute></time_entry></time_entries></schedule><is_std>1</is_std><order_index>1</order_index></agent><agent><id>auto_reminder</id><name>Внешние напоминания</name><is_active>1</is_active><code>lib_reminder.RunAgentAutoReminder()</code><schedule><use_term>1</use_term><term><length>30</length><unit_id>minute</unit_id></term></schedule><is_std>1</is_std><last_run_start_date>2020-03-05T14:17:11+06:00</last_run_start_date><last_run_date>2020-03-05T14:17:11+06:00</last_run_date><order_index>2</order_index></agent><agent><id>process_custom_actions</id><name>Обработка настраиваемых действий</name><is_active>1</is_active><code>lib_custom_action.RunAgentProcessCustomActions()</code><schedule><term><unit_id>d</unit_id></term><time_entries><time_entry><hour>11</hour><minute>0</minute></time_entry></time_entries></schedule><is_std>1</is_std><order_index>3</order_index></agent><agent><id>notifications_updater</id><name>Проверка уведомлений</name><is_active>1</is_active><code>lib_notif.notifications_updater_task()</code><run_on_client>1</run_on_client><schedule><use_term>1</use_term><term><length>5</length><unit_id>minute</unit_id></term></schedule><is_std>1</is_std><last_run_start_date>2020-03-05T14:27:13+06:00</last_run_start_date><last_run_date>2020-03-05T14:27:13+06:00</last_run_date><order_index>4</order_index></agent><agent><id>birthday_month_day_updater</id><name>Индексирование дней рождений</name><is_active>1</is_active><code>lib_person.RunAgentBirthdayMonthDayUpdater()</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>5</order_index></agent><agent><id>update_phone_call_records</id><name>История звонков: Перестроить</name><is_active>0</is_active><code>OpenCodeLib( 'x-app://base2/base2_agent_update_phone_call_records.js' ).UpdatePhoneCallRecords()</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>6</order_index></agent><agent><id>mailbox_scanner</id><name>Сканирование почтовых ящиков</name><is_active>1</is_active><code>OpenCodeLib( 'x-app://base2/base2_agent_mailbox_scanner.js' ).RunAgentMailboxScanner()</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>7</order_index></agent><agent><id>load_from_ext_calendar</id><name>Загрузка из внешнего календаря</name><is_active>1</is_active><code>lib_ext_calendar.load_mod_entries()</code><run_on_client>1</run_on_client><show_in_main_menu>1</show_in_main_menu><schedule><term><length>10</length><unit_id>minute</unit_id></term></schedule><is_std>1</is_std><order_index>0</order_index></agent><agent><id>check_divisions</id><name>Проверка статусов подразделений</name><is_active>1</is_active><code>OpenCodeLib( 'x-app://staff/staff_agent_check_divisions.js' ).RunAgentCheckDivisions()</code><schedule><term><unit_id>d</unit_id></term><time_entries><time_entry><hour>3</hour><minute>0</minute></time_entry></time_entries></schedule><is_std>1</is_std><order_index>0</order_index></agent><agent><id>check_testings</id><name>Проверка процессов тестирования</name><is_active>1</is_active><code>lib_testing.check_testings()</code><run_on_client>1</run_on_client><show_in_main_menu>1</show_in_main_menu><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>1</order_index></agent><agent><id>publish_vacancies_async</id><name>Пакетная публикация вакансий</name><is_active>1</is_active><code>lib_vacancy_publish.RunAgentPublishVacanciesAsync()</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><last_run_start_date>2020-03-05T13:51:40+06:00</last_run_start_date><last_run_date>2020-03-05T13:51:45+06:00</last_run_date><last_error>No site with asynchronous publishing is enabled</last_error><order_index>0</order_index></agent><agent><id>load_vacancy_responses</id><name>Загрузка откликов с собственного сайта</name><is_active>1</is_active><code>OpenCodeLib( 'x-app://imod/imod_agent_load_vacancy_responses.js' ).load_vacancy_responses()</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>1</order_index></agent><agent><id>clean_old_resp_candidates</id><name>Удаление устаревших откликов</name><is_active>1</is_active><code>lib_vacancy_responses.PurgeOldResponses()</code><schedule><use_term>1</use_term><term><length>1</length><unit_id>d</unit_id></term></schedule><is_std>1</is_std><last_run_start_date>2020-03-04T14:49:00+06:00</last_run_start_date><last_run_date>2020-03-04T14:49:00+06:00</last_run_date><order_index>2</order_index></agent><agent><id>staff_loader</id><name>Загрузка структурных подразделений из внешней системы</name><is_active>0</is_active><code>lib_staff_connector.load_divisions()</code><show_in_main_menu>1</show_in_main_menu><settings_section><holder>global_settings.staff_connector</holder><screen_form>//rcr/rcr_global_settings_staff_connector.xms</screen_form></settings_section><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>0</order_index></agent><agent><id>staff_positions_loader</id><name>Загрузка штатных должностей из внешней системы</name><is_active>0</is_active><code>lib_staff_connector.load_positions()</code><show_in_main_menu>1</show_in_main_menu><settings_section><holder>global_settings.staff_connector</holder><screen_form>//rcr/rcr_global_settings_staff_connector.xms</screen_form></settings_section><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>1</order_index></agent><agent><id>staff_persons_loader</id><name>Загрузка сотрудников из внешней системы</name><is_active>0</is_active><code>lib_staff_connector.load_persons()</code><show_in_main_menu>1</show_in_main_menu><settings_section><holder>global_settings.staff_connector</holder><screen_form>//rcr/rcr_global_settings_staff_connector.xms</screen_form></settings_section><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>2</order_index></agent><agent><id>staff_full_loader</id><name>Загрузка штатной структуры и сотрудников из внешней системы</name><is_active>1</is_active><code>lib_staff_connector.load_divisions();&#13;&#10;if ( global_settings.use_positions )&#13;&#10;&#9;lib_staff_connector.load_positions();&#13;&#10;lib_staff_connector.load_persons();</code><show_in_main_menu>1</show_in_main_menu><settings_section><holder>global_settings.staff_connector</holder><screen_form>//rcr/rcr_global_settings_staff_connector.xms</screen_form></settings_section><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>3</order_index></agent><agent><id>staff_vacancies_loader</id><name>Загрузка вакансий из внешней системы</name><is_active>1</is_active><code>lib_staff_connector.load_vacancies()</code><show_in_main_menu>1</show_in_main_menu><settings_section><holder>global_settings.staff_connector</holder><screen_form>//rcr/rcr_global_settings_staff_connector.xms</screen_form></settings_section><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>4</order_index></agent><agent><id>candidate_state_checker</id><name>Проверка предельного срока нахождения кандидата в статусе</name><is_active>1</is_active><code>OpenCodeLib( 'x-app://rcr/rcr_agent_candidate_state_checker.js' ).RunAgentCandidateStateChecker()</code><schedule><term><unit_id>d</unit_id></term><time_entries><time_entry><hour>2</hour><minute>0</minute></time_entry></time_entries></schedule><is_std>1</is_std><order_index>5</order_index></agent><agent><id>candidate_user_duty_checker</id><name>Проверка нахождения кандидата в работе</name><is_active>0</is_active><code>OpenCodeLib( 'x-app://rcr/rcr_agent_candidate_user_duty_checker.js' ).run_candidate_user_duty_checker()</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>6</order_index></agent><agent><id>check_external_event_states</id><name>Проверка статусов событий во внешних системах</name><is_active>1</is_active><code>lib_recruit.RunAgentCheckExternalEventStates()</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>7</order_index></agent><agent><id>unused_candidates_checker</id><name>Проверка неиспользованных кандидатов</name><is_active>1</is_active><code>&#13;&#10;if ( ! global_settings.use_candidate_unused_state || ! global_settings.unused_candidate_start_period.length.HasValue )&#13;&#10;&#9;return;&#13;&#10;&#13;&#10;query = 'for $elem in candidates where $elem/state_id = \'new\' and $elem/creation_date &lt; ' + XQueryLiteral( lib_base.get_term_date_neg_offset( CurDate, global_settings.unused_candidate_start_period ) ) + ' return $elem';&#13;&#10;&#13;&#10;idArray = ArrayExtract( XQuery( query ), 'id' );&#13;&#10;StartModalTask( 'Checking...' );&#13;&#10;&#13;&#10;for ( id in idArray )&#13;&#10;{&#13;&#10;&#9;candidateDoc = OpenDoc( ObjectDocUrl( 'data', 'candidate', id ) );&#13;&#10;&#9;candidate = candidateDoc.TopElem;&#13;&#10;&#13;&#10;&#9;ModalTaskMsg( candidate.fullname );&#13;&#10;&#13;&#10;&#9;candidate.update_state();&#13;&#10;&#9;candidateDoc.WriteDocInfo = false;&#13;&#10;&#9;candidateDoc.Save();&#13;&#10;}&#13;&#10;&#9;&#9;</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>8</order_index></agent><agent><id>bind_candidates_to_employees</id><name>Привязка принятых на работу кандидатов к сотрудникам</name><is_active>0</is_active><code>lib_candidate.RunAgentBindCandidatesToEmployees()</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>9</order_index></agent><agent><id>build_calendar_entries</id><name>Обновление календарных записей</name><is_active>1</is_active><code>&#13;&#10;query = 'for $elem in events where $elem/date &gt;= ' + XQueryLiteral( DateOffset( CurDate, 0 - 30 * 86400 ) ) + ' return $elem';&#13;&#10;&#13;&#10;array = ArraySelect( XQuery( query ), 'type.is_calendar_entry' );&#13;&#10;StartModalTask( 'Updating...' );&#13;&#10;&#13;&#10;for ( event in array )&#13;&#10;{&#13;&#10;&#9;ModalTaskMsg( event.date );&#13;&#10;&#13;&#10;&#9;//LogEvent( '', event.ObjectUrl );&#13;&#10;&#9;eventDoc = OpenDoc( event.ObjectUrl );&#13;&#10;&#13;&#10;&#9;entryDocUrl = ObjectDocUrl( 'data', 'calendar_entry', event.id );&#13;&#10;&#13;&#10;&#9;try&#13;&#10;&#9;{&#13;&#10;&#9;&#9;calendarEntryDoc = OpenDoc( entryDocUrl );&#13;&#10;&#9;&#9;continue;&#13;&#10;&#9;}&#13;&#10;&#9;catch ( e )&#13;&#10;&#9;{&#13;&#10;&#9;}&#13;&#10;&#13;&#10;&#9;calendarEntryDoc = OpenNewDoc( 'x-app://cn/cn_calendar_entry.xmd', 'separate=1' );&#13;&#10;&#9;calendarEntryDoc.Url = entryDocUrl;&#13;&#10;&#9;calendarEntryDoc.TopElem.AssignElem( eventDoc.TopElem );&#13;&#10;&#13;&#10;&#9;calendarEntryDoc.RunActionOnSave = false;&#13;&#10;&#9;calendarEntryDoc.WriteDocInfo = false;&#13;&#10;&#9;calendarEntryDoc.IsSeparated = false;&#13;&#10;&#9;calendarEntryDoc.Save();&#13;&#10;}&#13;&#10;&#9;&#9;</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>10</order_index></agent><agent><id>clean_up_calendar_entries</id><name>Удаление отключенных календарных записей</name><is_active>1</is_active><code>&#13;&#10;query = 'for $elem in calendar_entries order by $elem/date descending return $elem';&#13;&#10;array = XQuery( query );&#13;&#10;&#13;&#10;idArray = new Array;&#13;&#10;&#13;&#10;StartModalTask( 'Scanning calendar entries...' );&#13;&#10;&#13;&#10;for ( calendarEntry in array )&#13;&#10;{&#13;&#10;&#9;ModalTaskMsg( calendarEntry.date );&#13;&#10;&#13;&#10;&#9;if ( calendarEntry.type.is_calendar_entry )&#13;&#10;&#9;&#9;continue;&#13;&#10;&#13;&#10;&#9;idArray.push( calendarEntry.id );&#13;&#10;}&#13;&#10;&#13;&#10;if ( idArray.length == 0 )&#13;&#10;&#9;return;&#13;&#10;&#13;&#10;&#13;&#10;StartModalTask( 'Deleting calendar entries...' );&#13;&#10;&#13;&#10;&#13;&#10;for ( id in idArray )&#13;&#10;{&#13;&#10;&#9;ModalTaskMsg( id );&#13;&#10;&#13;&#10;&#9;eventDoc = OpenDoc( ObjectDocUrl( 'data', 'event', id ), 'separate=1' );&#13;&#10;&#13;&#10;&#9;DeleteDoc( ObjectDocUrl( 'data', 'calendar_entry', id ), true );&#13;&#10;&#13;&#10;&#9;eventDoc.WriteDocInfo = false;&#13;&#10;&#9;eventDoc.Save();&#13;&#10;}&#13;&#10;&#9;&#9;</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>11</order_index></agent><agent><id>update_candidate_states</id><name>Обновление статусов кандидатов</name><is_active>1</is_active><code>&#13;&#10;for ( candidateID in ArrayExtract( candidates, 'id' ) )&#13;&#10;{&#13;&#10;&#9;try&#13;&#10;&#9;{&#13;&#10;&#9;&#9;candidateDoc = DefaultDb.OpenObjectDoc( 'candidate', candidateID );&#13;&#10;&#9;}&#13;&#10;&#9;catch ( e )&#13;&#10;&#9;{&#13;&#10;&#9;&#9;alert( e );&#13;&#10;&#9;&#9;continue;&#13;&#10;&#9;}&#13;&#10;&#9;&#13;&#10;&#9;candidate = candidateDoc.TopElem;&#13;&#10;&#9;needUpdate = false;&#13;&#10;&#13;&#10;&#9;if ( ! candidate.state_date.HasValue || ! candidate.state_id.HasValue )&#13;&#10;&#9;{&#13;&#10;&#9;&#9;needUpdate = true;&#13;&#10;&#9;}&#13;&#10;&#9;else&#13;&#10;&#9;{&#13;&#10;&#9;&#9;for ( spot in candidate.spots )&#13;&#10;&#9;&#9;{&#13;&#10;&#9;&#9;&#9;if ( ! spot.state_date.HasValue || ! spot.state_id.HasValue )&#13;&#10;&#9;&#9;&#9;{&#13;&#10;&#9;&#9;&#9;&#9;needUpdate = true;&#13;&#10;&#9;&#9;&#9;&#9;break;&#13;&#10;&#9;&#9;&#9;}&#13;&#10;&#9;&#9;}&#13;&#10;&#9;}&#13;&#10;&#13;&#10;&#9;if ( ! needUpdate )&#13;&#10;&#9;&#9;continue;&#13;&#10;&#13;&#10;&#9;candidate.update_state();&#13;&#10;&#13;&#10;&#9;candidateDoc.WriteDocInfo = false;&#13;&#10;&#9;candidateDoc.RunActionOnSave = false;&#13;&#10;&#13;&#10;&#9;try&#13;&#10;&#9;{&#13;&#10;&#9;&#9;candidateDoc.Save();&#13;&#10;&#9;}&#13;&#10;&#9;catch ( e )&#13;&#10;&#9;{&#13;&#10;&#9;}&#13;&#10;}&#13;&#10;&#9;&#9;</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>12</order_index></agent><agent><id>update_vacancies_work_days_num</id><name>Пересчет фактических сроков поиска по вакансиям</name><is_active>1</is_active><code>OpenCodeLib( 'x-app://rcr/rcr_agent_update_vacancies_work_days_num.js' ).RunAgentUpdateVacanciesWorkDaysNum()</code><schedule><term><unit_id>d</unit_id></term></schedule><is_std>1</is_std><order_index>13</order_index></agent></agents>